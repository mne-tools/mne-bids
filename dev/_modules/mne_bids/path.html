
<!DOCTYPE html>


<html lang="en" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mne_bids.path &#8212; MNE-BIDS 0.13.dev0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=e5fbc548" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=7ce5be07" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=0b2f1c6e"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=fd10adb8"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-C8SH9E98QC"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-C8SH9E98QC');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/mne_bids/path';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/mne-tools/mne-bids/main/doc/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        </script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="canonical" href="https://mne.tools/mne-bids/stable/index.html" />
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../_static/scrollfix.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">MNE-BIDS 0.13.dev0 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../whats_new.html">
                        News
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../use.html">
                        Use
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../generated/cli.html">
                        CLI
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contribute.html">
                        Contribute
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      dev  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Quick Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/mne-tools/mne-bids" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://mne.discourse.group/tags/mne-bids" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../whats_new.html">
                        News
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../install.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../use.html">
                        Use
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../generated/cli.html">
                        CLI
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contribute.html">
                        Contribute
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      dev  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Quick Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/mne-tools/mne-bids" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://mne.discourse.group/tags/mne-bids" title="Discourse" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">Discourse</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">mne_bids.path</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for mne_bids.path</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;BIDS compatible path functionality.&quot;&quot;&quot;</span>
<span class="c1"># Authors: Adam Li &lt;adam2392@gmail.com&gt;</span>
<span class="c1">#          Stefan Appelhoff &lt;stefan.appelhoff@mailbox.org&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD-3-Clause</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">shutil</span> <span class="k">as</span> <span class="nn">sh</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span> <span class="k">as</span> <span class="n">op</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">indent</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mne.utils</span> <span class="kn">import</span> <span class="n">logger</span><span class="p">,</span> <span class="n">_validate_type</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">_check_fname</span>

<span class="kn">from</span> <span class="nn">mne_bids.config</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ALLOWED_PATH_ENTITIES</span><span class="p">,</span>
    <span class="n">ALLOWED_FILENAME_EXTENSIONS</span><span class="p">,</span>
    <span class="n">ALLOWED_FILENAME_SUFFIX</span><span class="p">,</span>
    <span class="n">ALLOWED_PATH_ENTITIES_SHORT</span><span class="p">,</span>
    <span class="n">ALLOWED_DATATYPES</span><span class="p">,</span>
    <span class="n">ALLOWED_DATATYPE_EXTENSIONS</span><span class="p">,</span>
    <span class="n">ALLOWED_SPACES</span><span class="p">,</span>
    <span class="n">reader</span><span class="p">,</span>
    <span class="n">ENTITY_VALUE_TYPE</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">mne_bids.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_check_key_val</span><span class="p">,</span>
    <span class="n">_check_empty_room_basename</span><span class="p">,</span>
    <span class="n">param_regex</span><span class="p">,</span>
    <span class="n">_ensure_tuple</span><span class="p">,</span>
    <span class="n">warn</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">mne_bids.tsv_handler</span> <span class="kn">import</span> <span class="n">_from_tsv</span><span class="p">,</span> <span class="n">_drop</span><span class="p">,</span> <span class="n">_to_tsv</span>


<span class="k">def</span> <span class="nf">_find_empty_room_candidates</span><span class="p">(</span><span class="n">bids_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get matching empty-room file for an MEG recording.&quot;&quot;&quot;</span>
    <span class="c1"># Check whether we have a BIDS root.</span>
    <span class="n">bids_root</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">root</span>
    <span class="k">if</span> <span class="n">bids_root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;The root of the &quot;bids_path&quot; must be set. &#39;</span>
            <span class="s1">&#39;Please use `bids_path.update(root=&quot;&lt;root&gt;&quot;)` &#39;</span>
            <span class="s2">&quot;to set the root of the BIDS folder to read.&quot;</span>
        <span class="p">)</span>

    <span class="n">bids_path</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">datatype</span> <span class="o">=</span> <span class="s2">&quot;meg&quot;</span>  <span class="c1"># We&#39;re only concerned about MEG data here</span>
    <span class="n">bids_fname</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span><span class="o">.</span><span class="n">fpath</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">_parse_ext</span><span class="p">(</span><span class="n">bids_fname</span><span class="p">)</span>
    <span class="n">emptyroom_dir</span> <span class="o">=</span> <span class="n">BIDSPath</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">bids_root</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;emptyroom&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">directory</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">emptyroom_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">()</span>

    <span class="c1"># Find the empty-room recording sessions.</span>
    <span class="n">emptyroom_session_dirs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">emptyroom_dir</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ses-&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">emptyroom_session_dirs</span><span class="p">:</span>  <span class="c1"># No session sub-directories found</span>
        <span class="n">emptyroom_session_dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">emptyroom_dir</span><span class="p">]</span>

    <span class="c1"># Now try to discover all recordings inside the session directories.</span>

    <span class="n">allowed_extensions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># `.pdf` is just a &quot;virtual&quot; extension for BTi data (which is stored inside</span>
    <span class="c1"># a dedicated directory that doesn&#39;t have an extension)</span>
    <span class="k">del</span> <span class="n">allowed_extensions</span><span class="p">[</span><span class="n">allowed_extensions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)]</span>

    <span class="n">candidate_er_fnames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">session_dir</span> <span class="ow">in</span> <span class="n">emptyroom_session_dirs</span><span class="p">:</span>
        <span class="n">dir_contents</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span>
            <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session_dir</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sub-emptyroom_*_</span><span class="si">{</span><span class="n">datatype</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dir_contents</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="n">allowed_extensions</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
            <span class="p">):</span>  <span class="c1"># Hopefully BTi?</span>
                <span class="n">candidate_er_fnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">er_fname</span> <span class="ow">in</span> <span class="n">candidate_er_fnames</span><span class="p">:</span>
        <span class="c1"># get entities from filenamme</span>
        <span class="n">er_bids_path</span> <span class="o">=</span> <span class="n">get_bids_path_from_fname</span><span class="p">(</span><span class="n">er_fname</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">er_bids_path</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s2">&quot;emptyroom&quot;</span>  <span class="c1"># er subject entity is different</span>
        <span class="n">er_bids_path</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">bids_root</span>
        <span class="n">er_bids_path</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="s2">&quot;meg&quot;</span>
        <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">er_bids_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">candidates</span>


<span class="k">def</span> <span class="nf">_find_matched_empty_room</span><span class="p">(</span><span class="n">bids_path</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">mne_bids</span> <span class="kn">import</span> <span class="n">read_raw_bids</span>  <span class="c1"># avoid circular import.</span>

    <span class="n">candidates</span> <span class="o">=</span> <span class="n">_find_empty_room_candidates</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>

    <span class="c1"># Walk through recordings, trying to extract the recording date:</span>
    <span class="c1"># First, from the filename; and if that fails, from `info[&#39;meas_date&#39;]`.</span>
    <span class="n">best_er_bids_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">min_delta_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">date_tie</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">failed_to_get_er_date_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">bids_path</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;meg&quot;</span><span class="p">)</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">read_raw_bids</span><span class="p">(</span><span class="n">bids_path</span><span class="o">=</span><span class="n">bids_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;meas_date&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The provided recording does not have a measurement &quot;</span>
            <span class="s2">&quot;date set. Cannot get matching empty-room file.&quot;</span>
        <span class="p">)</span>
    <span class="n">ref_date</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;meas_date&quot;</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">bids_path</span><span class="p">,</span> <span class="n">raw</span>
    <span class="k">for</span> <span class="n">er_bids_path</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
        <span class="c1"># get entities from filenamme</span>
        <span class="n">er_meas_date</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Try to extract date from filename.</span>
        <span class="k">if</span> <span class="n">er_bids_path</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">er_meas_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">er_bids_path</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="c1"># There is a session in the filename, but it doesn&#39;t encode a</span>
                <span class="c1"># valid date.</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="n">er_meas_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No luck so far! Check info[&#39;meas_date&#39;]</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">_parse_ext</span><span class="p">(</span><span class="n">er_bids_path</span><span class="o">.</span><span class="n">fpath</span><span class="p">)</span>
            <span class="n">extra_params</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.fif&quot;</span><span class="p">:</span>
                <span class="n">extra_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">allow_maxshield</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="p">)</span>

            <span class="n">er_raw</span> <span class="o">=</span> <span class="n">read_raw_bids</span><span class="p">(</span><span class="n">bids_path</span><span class="o">=</span><span class="n">er_bids_path</span><span class="p">,</span> <span class="n">extra_params</span><span class="o">=</span><span class="n">extra_params</span><span class="p">)</span>

            <span class="n">er_meas_date</span> <span class="o">=</span> <span class="n">er_raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;meas_date&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">er_meas_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># There&#39;s nothing we can do.</span>
                <span class="n">failed_to_get_er_date_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

        <span class="n">er_meas_date</span> <span class="o">=</span> <span class="n">er_meas_date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">ref_date</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">)</span>
        <span class="n">delta_t</span> <span class="o">=</span> <span class="n">er_meas_date</span> <span class="o">-</span> <span class="n">ref_date</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta_t</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span> <span class="o">==</span> <span class="n">min_delta_t</span><span class="p">:</span>
            <span class="n">date_tie</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta_t</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">min_delta_t</span><span class="p">:</span>
            <span class="n">min_delta_t</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta_t</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
            <span class="n">best_er_bids_path</span> <span class="o">=</span> <span class="n">er_bids_path</span>
            <span class="n">date_tie</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">failed_to_get_er_date_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not retrieve the empty-room measurement date from &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;a total of </span><span class="si">{</span><span class="n">failed_to_get_er_date_count</span><span class="si">}</span><span class="s2"> recording(s).&quot;</span>
        <span class="p">)</span>
        <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">date_tie</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Found more than one matching empty-room measurement with the &quot;</span>
            <span class="s2">&quot;same recording date. Selecting the first match.&quot;</span>
        <span class="p">)</span>
        <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">best_er_bids_path</span>


<div class="viewcode-block" id="BIDSPath"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath">[docs]</a><span class="k">class</span> <span class="nc">BIDSPath</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A BIDS path object.</span>

<span class="sd">    BIDS filename prefixes have one or more pieces of metadata in them. They</span>
<span class="sd">    must follow a particular order, which is followed by this function. This</span>
<span class="sd">    will generate the *prefix* for a BIDS filename that can be used with many</span>
<span class="sd">    subsequent files, or you may also give a suffix that will then complete</span>
<span class="sd">    the file name.</span>

<span class="sd">    BIDSPath allows dynamic updating of its entities in place, and operates</span>
<span class="sd">    similar to `pathlib.Path`. In addition, it can query multiple paths</span>
<span class="sd">    with matching BIDS entities via the ``match`` method.</span>

<span class="sd">    Note that not all parameters are applicable to each suffix of data. For</span>
<span class="sd">    example, electrode location TSV files do not need a &quot;task&quot; field.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    subject : str | None</span>
<span class="sd">        The subject ID. Corresponds to &quot;sub&quot;.</span>
<span class="sd">    session : str | None</span>
<span class="sd">        The acquisition session. Corresponds to &quot;ses&quot;.</span>
<span class="sd">    task : str | None</span>
<span class="sd">        The experimental task. Corresponds to &quot;task&quot;.</span>
<span class="sd">    acquisition: str | None</span>
<span class="sd">        The acquisition parameters. Corresponds to &quot;acq&quot;.</span>
<span class="sd">    run : int | None</span>
<span class="sd">        The run number. Corresponds to &quot;run&quot;.</span>
<span class="sd">    processing : str | None</span>
<span class="sd">        The processing label. Corresponds to &quot;proc&quot;.</span>
<span class="sd">    recording : str | None</span>
<span class="sd">        The recording name. Corresponds to &quot;rec&quot;.</span>
<span class="sd">    space : str | None</span>
<span class="sd">        The coordinate space for anatomical and sensor location</span>
<span class="sd">        files (e.g., ``*_electrodes.tsv``, ``*_markers.mrk``).</span>
<span class="sd">        Corresponds to &quot;space&quot;.</span>
<span class="sd">        Note that valid values for ``space`` must come from a list</span>
<span class="sd">        of BIDS keywords as described in the BIDS specification.</span>
<span class="sd">    split : int | None</span>
<span class="sd">        The split of the continuous recording file for ``.fif`` data.</span>
<span class="sd">        Corresponds to &quot;split&quot;.</span>
<span class="sd">    description : str | None</span>
<span class="sd">        This corresponds to the BIDS entity ``desc``. It is used to provide</span>
<span class="sd">        additional information for derivative data, e.g., preprocessed data</span>
<span class="sd">        may be assigned ``description=&#39;cleaned&#39;``.</span>

<span class="sd">        .. versionadded:: 0.11</span>
<span class="sd">    suffix : str | None</span>
<span class="sd">        The filename suffix. This is the entity after the</span>
<span class="sd">        last ``_`` before the extension. E.g., ``&#39;channels&#39;``.</span>
<span class="sd">        The following filename suffix&#39;s are accepted:</span>
<span class="sd">        &#39;meg&#39;, &#39;markers&#39;, &#39;eeg&#39;, &#39;ieeg&#39;, &#39;T1w&#39;,</span>
<span class="sd">        &#39;participants&#39;, &#39;scans&#39;, &#39;electrodes&#39;, &#39;coordsystem&#39;,</span>
<span class="sd">        &#39;channels&#39;, &#39;events&#39;, &#39;headshape&#39;, &#39;digitizer&#39;,</span>
<span class="sd">        &#39;beh&#39;, &#39;physio&#39;, &#39;stim&#39;</span>
<span class="sd">    extension : str | None</span>
<span class="sd">        The extension of the filename. E.g., ``&#39;.json&#39;``.</span>
<span class="sd">    datatype : str</span>
<span class="sd">        The BIDS data type, e.g., ``&#39;anat&#39;``, ``&#39;func&#39;``, ``&#39;eeg&#39;``, ``&#39;meg&#39;``,</span>
<span class="sd">        ``&#39;ieeg&#39;``.</span>
<span class="sd">    root : path-like | None</span>
<span class="sd">        The root directory of the BIDS dataset.</span>
<span class="sd">    check : bool</span>
<span class="sd">        If ``True``, enforces BIDS conformity. Defaults to ``True``.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    entities : dict</span>
<span class="sd">        A dictionary of the BIDS entities and their values:</span>
<span class="sd">        ``subject``, ``session``, ``task``, ``acquisition``,</span>
<span class="sd">        ``run``, ``processing``, ``space``, ``recording``,</span>
<span class="sd">        ``split``, ``description``, ``suffix``, and ``extension``.</span>
<span class="sd">    datatype : str | None</span>
<span class="sd">        The data type, i.e., one of ``&#39;meg&#39;``, ``&#39;eeg&#39;``, ``&#39;ieeg&#39;``,</span>
<span class="sd">        ``&#39;anat&#39;``.</span>
<span class="sd">    basename : str</span>
<span class="sd">        The basename of the file path. Similar to `os.path.basename(fpath)`.</span>
<span class="sd">    root : pathlib.Path</span>
<span class="sd">        The root of the BIDS path.</span>
<span class="sd">    directory : pathlib.Path</span>
<span class="sd">        The directory path.</span>
<span class="sd">    fpath : pathlib.Path</span>
<span class="sd">        The full file path.</span>
<span class="sd">    check : bool</span>
<span class="sd">        Whether to enforce BIDS conformity.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Generate a BIDSPath object and inspect it</span>

<span class="sd">    &gt;&gt;&gt; bids_path = BIDSPath(subject=&#39;test&#39;, session=&#39;two&#39;, task=&#39;mytask&#39;,</span>
<span class="sd">    ...                      suffix=&#39;ieeg&#39;, extension=&#39;.edf&#39;, datatype=&#39;ieeg&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(bids_path.basename)</span>
<span class="sd">    sub-test_ses-two_task-mytask_ieeg.edf</span>
<span class="sd">    &gt;&gt;&gt; bids_path</span>
<span class="sd">    BIDSPath(</span>
<span class="sd">    root: None</span>
<span class="sd">    datatype: ieeg</span>
<span class="sd">    basename: sub-test_ses-two_task-mytask_ieeg.edf)</span>

<span class="sd">    Copy and update multiple entities at once</span>

<span class="sd">    &gt;&gt;&gt; new_bids_path = bids_path.copy().update(subject=&#39;test2&#39;,</span>
<span class="sd">    ...                                         session=&#39;one&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(new_bids_path.basename)</span>
<span class="sd">    sub-test2_ses-one_task-mytask_ieeg.edf</span>

<span class="sd">    Printing a BIDSPath will show a relative path when `root` is not set</span>

<span class="sd">    &gt;&gt;&gt; print(new_bids_path)</span>
<span class="sd">    sub-test2/ses-one/ieeg/sub-test2_ses-one_task-mytask_ieeg.edf</span>

<span class="sd">    Setting `suffix` without an identifiable datatype will make</span>
<span class="sd">    BIDSPath try to guess the datatype</span>

<span class="sd">    &gt;&gt;&gt; new_bids_path = new_bids_path.update(suffix=&#39;channels&#39;,</span>
<span class="sd">    ...                                      extension=&#39;.tsv&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(new_bids_path)</span>
<span class="sd">    sub-test2/ses-one/ieeg/sub-test2_ses-one_task-mytask_channels.tsv</span>

<span class="sd">    You can set a new root for the BIDS dataset. Let&#39;s see what the</span>
<span class="sd">    different properties look like for our object:</span>

<span class="sd">    &gt;&gt;&gt; new_bids_path = new_bids_path.update(root=&#39;/bids_dataset&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(new_bids_path.root.as_posix())</span>
<span class="sd">    /bids_dataset</span>
<span class="sd">    &gt;&gt;&gt; print(new_bids_path.basename)</span>
<span class="sd">    sub-test2_ses-one_task-mytask_channels.tsv</span>
<span class="sd">    &gt;&gt;&gt; print(new_bids_path)</span>
<span class="sd">    /bids_dataset/sub-test2/ses-one/ieeg/sub-test2_ses-one_task-mytask_channels.tsv</span>
<span class="sd">    &gt;&gt;&gt; print(new_bids_path.directory.as_posix())</span>
<span class="sd">    /bids_dataset/sub-test2/ses-one/ieeg</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    BIDS entities are generally separated with a ``&quot;_&quot;`` character, while</span>
<span class="sd">    entity key/value pairs are separated with a ``&quot;-&quot;`` character.</span>
<span class="sd">    There are checks performed to make sure that there are no ``&#39;-&#39;``, ``&#39;_&#39;``,</span>
<span class="sd">    or ``&#39;/&#39;`` characters contained in any entity keys or values.</span>

<span class="sd">    To represent a filename such as ``dataset_description.json``,</span>
<span class="sd">    one can set ``check=False``, and pass ``suffix=&#39;dataset_description&#39;``</span>
<span class="sd">    and ``extension=&#39;.json&#39;``.</span>

<span class="sd">    ``BIDSPath`` can also be used to represent file and folder names of data</span>
<span class="sd">    types that are not yet supported through MNE-BIDS, but are recognized by</span>
<span class="sd">    BIDS. For example, one can set ``datatype`` to ``dwi`` or ``func`` and</span>
<span class="sd">    pass ``check=False`` to represent diffusion-weighted imaging and</span>
<span class="sd">    functional MRI paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">acquisition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">processing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">recording</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">split</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">ii</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">subject</span><span class="p">,</span>
                <span class="n">session</span><span class="p">,</span>
                <span class="n">task</span><span class="p">,</span>
                <span class="n">acquisition</span><span class="p">,</span>
                <span class="n">run</span><span class="p">,</span>
                <span class="n">processing</span><span class="p">,</span>
                <span class="n">recording</span><span class="p">,</span>
                <span class="n">space</span><span class="p">,</span>
                <span class="n">description</span><span class="p">,</span>
                <span class="n">root</span><span class="p">,</span>
                <span class="n">suffix</span><span class="p">,</span>
                <span class="n">extension</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one parameter must be given.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">check</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
            <span class="n">acquisition</span><span class="o">=</span><span class="n">acquisition</span><span class="p">,</span>
            <span class="n">run</span><span class="o">=</span><span class="n">run</span><span class="p">,</span>
            <span class="n">processing</span><span class="o">=</span><span class="n">processing</span><span class="p">,</span>
            <span class="n">recording</span><span class="o">=</span><span class="n">recording</span><span class="p">,</span>
            <span class="n">space</span><span class="o">=</span><span class="n">space</span><span class="p">,</span>
            <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">,</span>
            <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span>
            <span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return dictionary of the BIDS entities.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
            <span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">,</span>
            <span class="s2">&quot;acquisition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition</span><span class="p">,</span>
            <span class="s2">&quot;run&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">,</span>
            <span class="s2">&quot;processing&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">processing</span><span class="p">,</span>
            <span class="s2">&quot;space&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">,</span>
            <span class="s2">&quot;recording&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">recording</span><span class="p">,</span>
            <span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">basename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path basename.&quot;&quot;&quot;</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;datatype&quot;</span><span class="p">:</span>
                <span class="c1"># convert certain keys to shorthand</span>
                <span class="n">long_to_short_entity</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">val</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ALLOWED_PATH_ENTITIES_SHORT</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">long_to_short_entity</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">basename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">basename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">basename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span>

        <span class="n">basename</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">basename</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the BIDS parent directory.</span>

<span class="sd">        If ``subject``, ``session`` and ``datatype`` are set, then they will be</span>
<span class="sd">        used to construct the directory location. For example, if</span>
<span class="sd">        ``subject=&#39;01&#39;``, ``session=&#39;02&#39;`` and ``datatype=&#39;ieeg&#39;``, then the</span>
<span class="sd">        directory would be::</span>

<span class="sd">            &lt;root&gt;/sub-01/ses-02/ieeg</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_path : pathlib.Path</span>
<span class="sd">            The path of the BIDS directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create the data path based on the available entities:</span>
        <span class="c1"># root, subject, session, and datatype</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sub-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ses-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># datatype will allow &#39;meg&#39;, &#39;eeg&#39;, &#39;ieeg&#39;, &#39;anat&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_path</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">subject</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The subject ID.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subject</span>

    <span class="nd">@subject</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The acquisition session.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>

    <span class="nd">@session</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The experimental task.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span>

    <span class="nd">@task</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The run number.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span>

    <span class="nd">@run</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">run</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The acquisition parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquisition</span>

    <span class="nd">@acquisition</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">acquisition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">acquisition</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">processing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The processing label.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_processing</span>

    <span class="nd">@processing</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">processing</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">recording</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The recording name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recording</span>

    <span class="nd">@recording</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">recording</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">space</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The coordinate space for an anatomical or sensor position file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_space</span>

    <span class="nd">@space</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The description entity.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>

    <span class="nd">@description</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The filename suffix.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_suffix</span>

    <span class="nd">@suffix</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">suffix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The root directory of the BIDS dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span>

    <span class="nd">@root</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The BIDS data type, e.g. ``&#39;anat&#39;``, ``&#39;meg&#39;``, ``&#39;eeg&#39;``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span>

    <span class="nd">@datatype</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The split of the continuous recording file for ``.fif`` data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split</span>

    <span class="nd">@split</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extension</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The extension of the filename, including a leading period.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extension</span>

    <span class="nd">@extension</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the string representation of the path.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fpath</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Representation in the style of `pathlib.Path`.&quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;root: </span><span class="si">{</span><span class="n">root</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;datatype: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;basename: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__fspath__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the string representation for any fs functions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fpath</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare str representations.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare str representations.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="BIDSPath.copy"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy the instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bidspath : BIDSPath</span>
<span class="sd">            The copied bidspath.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="BIDSPath.mkdir"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.mkdir">[docs]</a>    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the directory structure of the BIDS path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        exist_ok : bool</span>
<span class="sd">            If ``False``, raise an exception if the directory already exists.</span>
<span class="sd">            Otherwise, do nothing (default).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : BIDSPath</span>
<span class="sd">            The BIDSPath object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="n">exist_ok</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="BIDSPath.rm"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.rm">[docs]</a>    <span class="nd">@verbose</span>
    <span class="k">def</span> <span class="nf">rm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">safe_remove</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Safely delete a set of files from a BIDS dataset.</span>

<span class="sd">        Deleting a scan that conforms to the bids-validator will</span>
<span class="sd">        remove the respective row in ``*_scans.tsv``,  the</span>
<span class="sd">        corresponding sidecar files, and the data file itself.</span>

<span class="sd">        Deleting all files of a subject will update the</span>
<span class="sd">        ``*_participants.tsv`` file.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        safe_remove : bool</span>
<span class="sd">            If ``False``, directly delete and update the files.</span>
<span class="sd">            Otherwise, displays the list of operations planned</span>
<span class="sd">            and asks for user confirmation before</span>
<span class="sd">            executing them (default).</span>
<span class="sd">        %(verbose)s</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : BIDSPath</span>
<span class="sd">            The BIDSPath object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Remove one specific run:</span>

<span class="sd">        &gt;&gt;&gt; bids_path = BIDSPath(subject=&#39;01&#39;, session=&#39;01&#39;, run=&quot;01&quot;,  # doctest: +SKIP</span>
<span class="sd">        ...                      root=&#39;/bids_dataset&#39;).rm()  # doctest: +SKIP</span>
<span class="sd">        Please, confirm you want to execute the following operations:</span>
<span class="sd">        Delete:</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-01_channels.tsv</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-01_events.json</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-01_events.tsv</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-01_meg.fif</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-01_meg.json</span>
<span class="sd">        Update:</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/sub-01_ses-01_scans.tsv</span>
<span class="sd">        I confirm [y/N]&gt;? y</span>

<span class="sd">        Remove all the files of a specific subject:</span>

<span class="sd">        &gt;&gt;&gt; bids_path = BIDSPath(subject=&#39;01&#39;, root=&#39;/bids_dataset&#39;,  # doctest: +SKIP</span>
<span class="sd">        ...                      check=False).rm()  # doctest: +SKIP</span>
<span class="sd">        Please, confirm you want to execute the following operations:</span>
<span class="sd">        Delete:</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_acq-calibration_meg.dat</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_acq-crosstalk_meg.fif</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_coordsystem.json</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-02_channels.tsv</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-02_events.json</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-02_events.tsv</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-02_meg.fif</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/meg/sub-01_ses-01_run-02_meg.json</span>
<span class="sd">        /bids_dataset/sub-01/ses-01/sub-01_ses-01_scans.tsv</span>
<span class="sd">        /bids_dataset/sub-01</span>
<span class="sd">        Update:</span>
<span class="sd">        /bids_dataset/participants.tsv</span>
<span class="sd">        I confirm [y/N]&gt;? y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># only proceed if root is defined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The root must not be None to remove files.&quot;</span><span class="p">)</span>

        <span class="c1"># Planning:</span>
        <span class="n">paths_matched</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ignore_json</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">)</span>
        <span class="n">subjects</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">paths_to_delete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">paths_to_update</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">subjects_paths_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">participants_tsv_fpath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">bids_path</span> <span class="ow">in</span> <span class="n">paths_matched</span><span class="p">:</span>
            <span class="n">paths_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>
            <span class="c1"># if a datatype is present, then check</span>
            <span class="c1"># if a scan is deleted or not</span>
            <span class="k">if</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># read in the corresponding scans file</span>
                <span class="n">scans_fpath</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">bids_path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">find_matching_sidecar</span><span class="p">(</span>
                        <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;scans&quot;</span><span class="p">,</span>
                        <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.tsv&quot;</span><span class="p">,</span>
                        <span class="n">on_error</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">paths_to_update</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">scans_fpath</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>
            <span class="n">subjects</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bids_path</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>

        <span class="n">files_to_delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">fpath</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths_to_delete</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
            <span class="c1"># check existence of files in the subject dir</span>
            <span class="n">subj_path</span> <span class="o">=</span> <span class="n">BIDSPath</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">)</span>
            <span class="n">subj_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">fpath</span> <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">subj_path</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">fpath</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">subj_files</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">files_to_delete</span><span class="p">:</span>
                <span class="n">subjects_paths_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subj_path</span><span class="p">)</span>
                <span class="n">participants_tsv_fpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">/</span> <span class="s2">&quot;participants.tsv&quot;</span>

        <span class="c1"># Informing:</span>
        <span class="n">pretty_delete_paths</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths_to_delete</span>
                <span class="o">+</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">directory</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">subjects_paths_to_delete</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">pretty_update_paths</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">paths_to_update</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="o">+</span> <span class="p">(</span>
                    <span class="p">[</span><span class="n">participants_tsv_fpath</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">participants_tsv_fpath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="p">[]</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pretty_delete_paths</span><span class="p">:</span>
            <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Delete:</span><span class="se">\n</span><span class="si">{</span><span class="n">pretty_delete_paths</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">pretty_update_paths</span><span class="p">:</span>
            <span class="n">summary</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Update:</span><span class="se">\n</span><span class="si">{</span><span class="n">pretty_update_paths</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">safe_remove</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="s2">&quot;Please, confirm you want to execute the following operations:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="se">\n</span><span class="s2">I confirm [y/N]&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">choice</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing the following operations:</span><span class="se">\n</span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Execution:</span>
        <span class="k">for</span> <span class="n">bids_path</span> <span class="ow">in</span> <span class="n">paths_to_delete</span><span class="p">:</span>
            <span class="n">bids_path</span><span class="o">.</span><span class="n">fpath</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">scans_fpath</span><span class="p">,</span> <span class="n">bids_paths</span> <span class="ow">in</span> <span class="n">paths_to_update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scans_fpath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="c1"># get the relative datatype of these bids files</span>
            <span class="n">bids_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">fpath</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">bids_paths</span><span class="p">]</span>

            <span class="n">scans_tsv</span> <span class="o">=</span> <span class="n">_from_tsv</span><span class="p">(</span><span class="n">scans_fpath</span><span class="p">)</span>
            <span class="n">scans_tsv</span> <span class="o">=</span> <span class="n">_drop</span><span class="p">(</span><span class="n">scans_tsv</span><span class="p">,</span> <span class="n">bids_fnames</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">)</span>
            <span class="n">_to_tsv</span><span class="p">(</span><span class="n">scans_tsv</span><span class="p">,</span> <span class="n">scans_fpath</span><span class="p">)</span>

        <span class="n">subjects_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">subj_path</span> <span class="ow">in</span> <span class="n">subjects_paths_to_delete</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subj_path</span><span class="o">.</span><span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">subj_path</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
            <span class="n">subjects_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subj_path</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subjects_to_delete</span> <span class="ow">and</span> <span class="n">participants_tsv_fpath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">participants_tsv</span> <span class="o">=</span> <span class="n">_from_tsv</span><span class="p">(</span><span class="n">participants_tsv_fpath</span><span class="p">)</span>
            <span class="n">participants_tsv</span> <span class="o">=</span> <span class="n">_drop</span><span class="p">(</span>
                <span class="n">participants_tsv</span><span class="p">,</span> <span class="n">subjects_to_delete</span><span class="p">,</span> <span class="s2">&quot;participant_id&quot;</span>
            <span class="p">)</span>
            <span class="n">_to_tsv</span><span class="p">(</span><span class="n">participants_tsv</span><span class="p">,</span> <span class="n">participants_tsv_fpath</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Full filepath for this BIDS file.</span>

<span class="sd">        Getting the file path consists of the entities passed in</span>
<span class="sd">        and will get the relative (or full if ``root`` is passed)</span>
<span class="sd">        path.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bids_fpath : pathlib.Path</span>
<span class="sd">            Either the relative, or full path to the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the inner-most BIDS directory for this file path</span>
        <span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>

        <span class="c1"># account for MEG data that are directory-based</span>
        <span class="c1"># else, all other file paths attempt to match</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;meg&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.ds&quot;</span><span class="p">:</span>
            <span class="n">bids_fpath</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;meg&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">:</span>
            <span class="n">bids_fpath</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if suffix and/or extension is missing, and root is</span>
            <span class="c1"># not None, then BIDSPath will infer the dataset</span>
            <span class="c1"># else, return the relative path with the basename</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># get matching BIDSPaths inside the bids root</span>
                <span class="n">matching_paths</span> <span class="o">=</span> <span class="n">_get_matching_bidspaths_from_filesystem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="c1"># FIXME This will break</span>
                <span class="c1"># FIXME e.g. with FIFF data split across multiple files.</span>
                <span class="c1"># if extension is not specified and no unique file path</span>
                <span class="c1"># return filepath of the actual dataset for MEG/EEG/iEEG data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="n">ALLOWED_DATATYPES</span><span class="p">:</span>
                    <span class="c1"># now only use valid datatype extension</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">valid_exts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ALLOWED_DATATYPE_EXTENSIONS</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="p">[])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">valid_exts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">]</span>
                    <span class="n">matching_paths</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">matching_paths</span> <span class="k">if</span> <span class="n">_parse_ext</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">valid_exts</span>
                    <span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">matching_paths</span> <span class="ow">or</span> <span class="s2">&quot;_split-&quot;</span> <span class="ow">in</span> <span class="n">matching_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="c1"># try finding FIF split files (only first one)</span>
                    <span class="n">this_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">split</span><span class="o">=</span><span class="s2">&quot;01&quot;</span><span class="p">)</span>
                    <span class="n">matching_paths</span> <span class="o">=</span> <span class="n">_get_matching_bidspaths_from_filesystem</span><span class="p">(</span><span class="n">this_self</span><span class="p">)</span>

                <span class="c1"># found no matching paths</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_paths</span><span class="p">:</span>
                    <span class="n">bids_fpath</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>
                <span class="c1"># if paths still cannot be resolved, then there is an error</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matching_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">matching_paths_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">matching_paths</span><span class="p">))</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;Found more than one matching data file for the &quot;</span>
                        <span class="s2">&quot;requested recording. While searching:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indent</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;    &quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matching_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> paths:</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indent</span><span class="p">(</span><span class="n">matching_paths_str</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;    &quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="s2">&quot;Cannot proceed due to the &quot;</span>
                        <span class="s2">&quot;ambiguity. This is likely a problem with your &quot;</span>
                        <span class="s2">&quot;BIDS dataset. Please run the BIDS validator on &quot;</span>
                        <span class="s2">&quot;your data.&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bids_fpath</span> <span class="o">=</span> <span class="n">matching_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bids_fpath</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">)</span>

        <span class="n">bids_fpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_fpath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bids_fpath</span>

<div class="viewcode-block" id="BIDSPath.update"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update inplace BIDS entity key/value pairs in object.</span>

<span class="sd">        ``run`` and ``split`` are auto-converted to have two</span>
<span class="sd">        digits. For example, if ``run=1``, then it will nbecome ``run=&#39;01&#39;``.</span>

<span class="sd">        Also performs error checks on various entities to</span>
<span class="sd">        adhere to the BIDS specification. Specifically:</span>
<span class="sd">        - ``datatype`` should be one of: ``anat``, ``eeg``, ``ieeg``, ``meg``</span>
<span class="sd">        - ``extension`` should be one of the accepted file</span>
<span class="sd">        extensions in the file path: ``.con``, ``.sqd``, ``.fif``,</span>
<span class="sd">        ``.pdf``, ``.ds``, ``.vhdr``, ``.edf``, ``.bdf``, ``.set``,</span>
<span class="sd">        ``.edf``, ``.set``, ``.mef``, ``.nwb``</span>
<span class="sd">        - ``suffix`` should be one of the acceptable file suffixes in: ``meg``,</span>
<span class="sd">        ``markers``, ``eeg``, ``ieeg``, ``T1w``,</span>
<span class="sd">        ``participants``, ``scans``, ``electrodes``, ``channels``,</span>
<span class="sd">        ``coordsystem``, ``events``, ``headshape``, ``digitizer``,</span>
<span class="sd">        ``beh``, ``physio``, ``stim``</span>
<span class="sd">        - Depending on the modality of the data (EEG, MEG, iEEG),</span>
<span class="sd">        ``space`` should be a valid string according to Appendix VIII</span>
<span class="sd">        in the BIDS specification.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        check : None | bool</span>
<span class="sd">            If a boolean, controls whether to enforce BIDS conformity. This</span>
<span class="sd">            will set the ``.check`` attribute accordingly. If ``None``, rely on</span>
<span class="sd">            the existing ``.check`` attribute instead, which is set upon</span>
<span class="sd">            `mne_bids.BIDSPath` instantiation. Defaults to ``None``.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            It can contain updates for valid BIDSPath entities:</span>
<span class="sd">            &#39;subject&#39;, &#39;session&#39;, &#39;task&#39;, &#39;acquisition&#39;, &#39;processing&#39;, &#39;run&#39;,</span>
<span class="sd">            &#39;recording&#39;, &#39;space&#39;, &#39;suffix&#39;, &#39;split&#39;, &#39;extension&#39;,</span>
<span class="sd">            or updates for &#39;root&#39; or &#39;datatype&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bidspath : BIDSPath</span>
<span class="sd">            The updated instance of BIDSPath.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        If one creates a bids basename using</span>
<span class="sd">        :func:`mne_bids.BIDSPath`:</span>

<span class="sd">        &gt;&gt;&gt; bids_path = BIDSPath(subject=&#39;test&#39;, session=&#39;two&#39;,</span>
<span class="sd">        ...                      task=&#39;mytask&#39;, suffix=&#39;channels&#39;,</span>
<span class="sd">        ...                      extension=&#39;.tsv&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(bids_path.basename)</span>
<span class="sd">        sub-test_ses-two_task-mytask_channels.tsv</span>
<span class="sd">        &gt;&gt;&gt; # Then, one can update this `BIDSPath` object in place</span>
<span class="sd">        &gt;&gt;&gt; bids_path.update(acquisition=&#39;test&#39;, suffix=&#39;ieeg&#39;,</span>
<span class="sd">        ...                  datatype=&#39;ieeg&#39;,</span>
<span class="sd">        ...                  extension=&#39;.vhdr&#39;, task=None)</span>
<span class="sd">        BIDSPath(</span>
<span class="sd">        root: None</span>
<span class="sd">        datatype: ieeg</span>
<span class="sd">        basename: sub-test_ses-two_acq-test_ieeg.vhdr)</span>
<span class="sd">        &gt;&gt;&gt; print(bids_path.basename)</span>
<span class="sd">        sub-test_ses-two_acq-test_ieeg.vhdr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update .check attribute</span>
        <span class="k">if</span> <span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">check</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span><span class="p">:</span>
                <span class="n">_validate_type</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;path-like&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">item_name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;datatype&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATATYPES</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;datatype (</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">) is not valid. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Should be one of &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ALLOWED_DATATYPES</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ENTITY_VALUE_TYPE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Key must be one of &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ALLOWED_PATH_ENTITIES</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">ENTITY_VALUE_TYPE</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
                <span class="n">_validate_type</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="n">item_name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ENTITY_VALUE_TYPE</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span>
                <span class="n">_validate_type</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">item_name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is not an index (Got </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:02}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># ensure extension starts with a &#39;.&#39;</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;extension&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">extension</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;extension should start with a period &quot;.&quot;, but got: &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s1">&quot;. Prepending &quot;.&quot; to form: &quot;.</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s1">&quot;. &#39;</span>
                <span class="sa">f</span><span class="s2">&quot;This will raise an exception starting with MNE-BIDS 0.12.&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;extension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># Uncomment in 0.12, and remove above code:</span>
            <span class="c1">#</span>
            <span class="c1"># raise ValueError(</span>
            <span class="c1">#     f&#39;Extension must start wie a period &quot;.&quot;, but got: &#39;</span>
            <span class="c1">#     f&#39;{extension}&#39;</span>
            <span class="c1"># )</span>
        <span class="k">del</span> <span class="n">extension</span>

        <span class="c1"># error check entities</span>
        <span class="n">old_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># check if there are any characters not allowed</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;root&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;suffix&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">:</span>
                    <span class="c1"># suffix may skip a check if check=False to allow</span>
                    <span class="c1"># things like &quot;dataset_description.json&quot;</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_check_key_val</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

            <span class="c1"># set entity value, ensuring `root` is a Path</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
            <span class="n">old_kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Perform a check of the entities and revert changes if check fails</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">old_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">old_kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">old_check</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="BIDSPath.match"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.match">[docs]</a>    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_json</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of all matching paths in the root directory.</span>

<span class="sd">        Performs a recursive search, starting in ``.root`` (if set), based on</span>
<span class="sd">        `BIDSPath.entities` object. Ignores ``.json`` files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ignore_json : bool</span>
<span class="sd">            If ``True``, ignores json files. Defaults to ``True``.</span>
<span class="sd">        check : bool</span>
<span class="sd">            If ``True``, only returns paths that conform to BIDS. If ``False``</span>
<span class="sd">            (default), the ``.check`` attribute of the returned</span>
<span class="sd">            `mne_bids.BIDSPath` object will be set to ``True`` for paths that</span>
<span class="sd">            do conform to BIDS, and to ``False`` for those that don&#39;t.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bids_paths : list of mne_bids.BIDSPath</span>
<span class="sd">            The matching paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot match basenames if `root` &quot;</span>
                <span class="s2">&quot;attribute is not set. Please set the&quot;</span>
                <span class="s2">&quot;BIDS root directory path to `root` via &quot;</span>
                <span class="s2">&quot;BIDSPath.update().&quot;</span>
            <span class="p">)</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="n">_return_root_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">ignore_json</span><span class="o">=</span><span class="n">ignore_json</span>
        <span class="p">)</span>

        <span class="n">fnames</span> <span class="o">=</span> <span class="n">_filter_fnames</span><span class="p">(</span>
            <span class="n">paths</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">suffix</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span>
        <span class="p">)</span>

        <span class="n">bids_paths</span> <span class="o">=</span> <span class="n">_fnames_to_bidspaths</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">check</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bids_paths</span></div>

    <span class="k">def</span> <span class="nf">_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deep check or not of the instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basename</span>  <span class="c1"># run basename to check validity of arguments</span>

        <span class="c1"># perform error check on scans</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;scans&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.tsv&quot;</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="n">_check_non_sub_ses_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;scans.tsv file name can only contain &quot;</span>
                <span class="s2">&quot;subject and session entities. BIDSPath &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;currently contains </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># perform deeper check if user has it turned on</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">==</span> <span class="s2">&quot;emptyroom&quot;</span><span class="p">:</span>
                <span class="n">_check_empty_room_basename</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># ensure extension starts with a &#39;.&#39;</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span>
            <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># check validity of the extension</span>
                <span class="k">if</span> <span class="n">extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_FILENAME_EXTENSIONS</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Extension </span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2"> is not &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;allowed. Use one of these extensions &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ALLOWED_FILENAME_EXTENSIONS</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># labels from space entity must come from list (appendix VIII)</span>
            <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span>
            <span class="k">if</span> <span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">datatype</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;datatype&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;You must define datatype if you want to &quot;</span>
                        <span class="s2">&quot;use space in your BIDSPath.&quot;</span>
                    <span class="p">)</span>

                <span class="n">allowed_spaces_for_dtype</span> <span class="o">=</span> <span class="n">ALLOWED_SPACES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">datatype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">allowed_spaces_for_dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;space entity is not valid for datatype &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">space</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_spaces_for_dtype</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;space (</span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2">) is not valid for &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;datatype (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s2">).</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Should be one of &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">allowed_spaces_for_dtype</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># error check suffix</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix</span>
            <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">suffix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_FILENAME_SUFFIX</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Suffix </span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2"> is not allowed. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Use one of these suffixes &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ALLOWED_FILENAME_SUFFIX</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

<div class="viewcode-block" id="BIDSPath.find_empty_room"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.find_empty_room">[docs]</a>    <span class="nd">@verbose</span>
    <span class="k">def</span> <span class="nf">find_empty_room</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_sidecar_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the corresponding empty-room file of an MEG recording.</span>

<span class="sd">        This will only work if the ``.root`` attribute of the</span>
<span class="sd">        :class:`mne_bids.BIDSPath` instance has been set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        use_sidecar_only : bool</span>
<span class="sd">            Whether to only check the ``AssociatedEmptyRoom`` entry in the</span>
<span class="sd">            sidecar JSON file or not. If ``False``, first look for the entry,</span>
<span class="sd">            and if unsuccessful, try to find the best-matching empty-room</span>
<span class="sd">            recording in the dataset based on the measurement date.</span>
<span class="sd">        %(verbose)s</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BIDSPath | None</span>
<span class="sd">            The path corresponding to the best-matching empty-room measurement.</span>
<span class="sd">            Returns ``None`` if none was found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;meg&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty-room data is only supported for MEG &quot;</span> <span class="s2">&quot;datasets&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;The root of the &quot;bids_path&quot; must be set. &#39;</span>
                <span class="s1">&#39;Please use `bids_path.update(root=&quot;&lt;root&gt;&quot;)` &#39;</span>
                <span class="s2">&quot;to set the root of the BIDS folder to read.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># needed to deal with inheritance principle</span>
        <span class="n">sidecar_fname</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;meg&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">find_matching_sidecar</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sidecar_fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">sidecar_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;AssociatedEmptyRoom&quot;</span> <span class="ow">in</span> <span class="n">sidecar_json</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Using &quot;AssociatedEmptyRoom&quot; entry from MEG sidecar &#39;</span>
                <span class="s2">&quot;file to retrieve empty-room path.&quot;</span>
            <span class="p">)</span>
            <span class="n">emptytoom_path</span> <span class="o">=</span> <span class="n">sidecar_json</span><span class="p">[</span><span class="s2">&quot;AssociatedEmptyRoom&quot;</span><span class="p">]</span>
            <span class="n">er_bids_path</span> <span class="o">=</span> <span class="n">get_bids_path_from_fname</span><span class="p">(</span><span class="n">emptytoom_path</span><span class="p">)</span>
            <span class="n">er_bids_path</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
            <span class="n">er_bids_path</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="s2">&quot;meg&quot;</span>
        <span class="k">elif</span> <span class="n">use_sidecar_only</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;The MEG sidecar file does not contain an &quot;</span>
                <span class="s1">&#39;&quot;AssociatedEmptyRoom&quot; entry. Aborting search for an &#39;</span>
                <span class="s2">&quot;empty-room recording, as you passed use_sidecar_only=True&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;The MEG sidecar file does not contain an &quot;</span>
                <span class="s1">&#39;&quot;AssociatedEmptyRoom&quot; entry. Will try to find a matching &#39;</span>
                <span class="s2">&quot;empty-room recording based on the measurement date &quot;</span>
            <span class="p">)</span>
            <span class="n">er_bids_path</span> <span class="o">=</span> <span class="n">_find_matched_empty_room</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">er_bids_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">er_bids_path</span><span class="o">.</span><span class="n">fpath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Empty-room BIDS path resolved but not found:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">er_bids_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Check your BIDS dataset for completeness.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">er_bids_path</span></div>

<div class="viewcode-block" id="BIDSPath.get_empty_room_candidates"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.get_empty_room_candidates">[docs]</a>    <span class="k">def</span> <span class="nf">get_empty_room_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the list of empty-room candidates for the given file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        candidates : list of BIDSPath</span>
<span class="sd">            The candidate files that will be checked if the sidecar does not</span>
<span class="sd">            contain an &quot;AssociatedEmptyRoom&quot; entry.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. versionadded:: 0.12.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_find_empty_room_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="BIDSPath.find_matching_sidecar"><a class="viewcode-back" href="../../generated/mne_bids.BIDSPath.html#mne_bids.BIDSPath.find_matching_sidecar">[docs]</a>    <span class="k">def</span> <span class="nf">find_matching_sidecar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_error</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the matching sidecar JSON path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        suffix : str | None</span>
<span class="sd">            The filename suffix. This is the entity after the last ``_``</span>
<span class="sd">            before the extension. E.g., ``&#39;ieeg&#39;``.</span>
<span class="sd">        extension : str | None</span>
<span class="sd">            The extension of the filename. E.g., ``&#39;.json&#39;``.</span>
<span class="sd">        on_error : &#39;raise&#39; | &#39;warn&#39; | &#39;ignore&#39;</span>
<span class="sd">            If no matching sidecar file was found and this is set to</span>
<span class="sd">            ``&#39;raise&#39;``, raise a ``RuntimeError``. If ``&#39;warn&#39;``, emit a</span>
<span class="sd">            warning, and if ``&#39;ignore&#39;``, neither raise an exception nor a</span>
<span class="sd">            warning, and return ``None`` in both cases.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sidecar_path : pathlib.Path | None</span>
<span class="sd">            The path to the sidecar JSON file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_find_matching_sidecar</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span>
            <span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span>
            <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meg_calibration_fpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the matching Elekta/Neuromag/MEGIN fine-calibration file.</span>

<span class="sd">        This requires that at least ``root`` and ``subject`` are set, and that</span>
<span class="sd">        ``datatype`` is either ``&#39;meg&#39;`` or ``None``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        path : pathlib.Path | None</span>
<span class="sd">            The path of the fine-calibration file, or ``None`` if it couldn&#39;t</span>
<span class="sd">            be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;root and subject must be set.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;meg&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only find fine-calibration file for MEG &quot;</span> <span class="s2">&quot;datasets.&quot;</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">BIDSPath</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
            <span class="n">acquisition</span><span class="o">=</span><span class="s2">&quot;calibration&quot;</span><span class="p">,</span>
            <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;meg&quot;</span><span class="p">,</span>
            <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;meg&quot;</span><span class="p">,</span>
            <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fpath</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">path</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meg_crosstalk_fpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the matching Elekta/Neuromag/MEGIN crosstalk file.</span>

<span class="sd">        This requires that at least ``root`` and ``subject`` are set, and that</span>
<span class="sd">        ``datatype`` is either ``&#39;meg&#39;`` or ``None``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        path : pathlib.Path | None</span>
<span class="sd">            The path of the crosstalk file, or ``None`` if it couldn&#39;t be</span>
<span class="sd">            found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;root and subject must be set.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;meg&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only find crosstalk file for MEG datasets.&quot;</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">BIDSPath</span><span class="p">(</span>
            <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
            <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
            <span class="n">acquisition</span><span class="o">=</span><span class="s2">&quot;crosstalk&quot;</span><span class="p">,</span>
            <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;meg&quot;</span><span class="p">,</span>
            <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.fif&quot;</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;meg&quot;</span><span class="p">,</span>
            <span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fpath</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">path</span></div>


<span class="k">def</span> <span class="nf">_get_matching_bidspaths_from_filesystem</span><span class="p">(</span><span class="n">bids_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get matching file paths for a BIDSPath.</span>

<span class="sd">    Assumes suffix and/or extension is not provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># extract relevant entities to find filepath</span>
    <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">session</span>
    <span class="n">datatype</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">datatype</span>
    <span class="n">basename</span><span class="p">,</span> <span class="n">bids_root</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">root</span>

    <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">_infer_datatype</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">bids_root</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="o">=</span><span class="n">ses</span><span class="p">)</span>

    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">BIDSPath</span><span class="p">(</span>
        <span class="n">subject</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">ses</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">bids_root</span>
    <span class="p">)</span><span class="o">.</span><span class="n">directory</span>

    <span class="c1"># For BTI data, just return the directory with a &#39;.pdf&#39; extension</span>
    <span class="c1"># to facilitate reading in mne-bids</span>
    <span class="n">bti_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">bti_dir</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assuming BTi data in </span><span class="si">{</span><span class="n">bti_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">matching_paths</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bti_dir</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">]</span>
    <span class="c1"># otherwise, search for valid file paths</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">search_str</span> <span class="o">=</span> <span class="n">bids_root</span>
        <span class="c1"># parse down the BIDS directory structure</span>
        <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_str</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sub-</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_str</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ses-</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_str</span><span class="p">,</span> <span class="n">datatype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_str</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="n">search_str</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_str</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>

        <span class="c1"># Find all matching files in all supported formats.</span>
        <span class="n">valid_exts</span> <span class="o">=</span> <span class="n">ALLOWED_FILENAME_EXTENSIONS</span>
        <span class="n">matching_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">search_str</span><span class="p">)</span>
        <span class="n">matching_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">matching_paths</span> <span class="k">if</span> <span class="n">_parse_ext</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">valid_exts</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">matching_paths</span>


<span class="k">def</span> <span class="nf">_check_non_sub_ses_entity</span><span class="p">(</span><span class="n">bids_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check existence of non subject/session entities in BIDSPath.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">bids_path</span><span class="o">.</span><span class="n">task</span>
        <span class="ow">or</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">acquisition</span>
        <span class="ow">or</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">run</span>
        <span class="ow">or</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">space</span>
        <span class="ow">or</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">recording</span>
        <span class="ow">or</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">split</span>
        <span class="ow">or</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">processing</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_print_lines_with_entry</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">is_tsv</span><span class="p">,</span> <span class="n">line_numbers</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print the lines that contain the entry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file : str</span>
<span class="sd">        The text file to look though.</span>
<span class="sd">    entry : str</span>
<span class="sd">        The string to look in the text file for.</span>
<span class="sd">    folder : str</span>
<span class="sd">        The base folder for relative file path printing.</span>
<span class="sd">    is_tsv : bool</span>
<span class="sd">        If ``True``, things that format a tsv nice will be used.</span>
<span class="sd">    line_numbers : bool</span>
<span class="sd">        Whether to include line numbers in the printout.</span>
<span class="sd">    outfile : io.StringIO | None</span>
<span class="sd">        The argument to pass to `print` for `file`. If ``None``,</span>
<span class="sd">        prints to the console, else a string is printed to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entry_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_tsv</span><span class="p">:</span>  <span class="c1"># format tsv files nicely</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">_truncate_tsv_line</span><span class="p">(</span><span class="n">fid</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">line_numbers</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;1    </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">header</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fid</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_tsv</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">_truncate_tsv_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line_numbers</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">line</span>
                <span class="n">entry_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">entry_lines</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">folder</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_tsv</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry_lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">entry_lines</span> <span class="o">=</span> <span class="n">entry_lines</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
            <span class="n">entry_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">entry_lines</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_truncate_tsv_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">lim</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Truncate a line to the specified number of characters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">lim</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lim</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="p">[:</span><span class="n">lim</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>


<div class="viewcode-block" id="search_folder_for_text"><a class="viewcode-back" href="../../generated/mne_bids.search_folder_for_text.html#mne_bids.search_folder_for_text">[docs]</a><span class="k">def</span> <span class="nf">search_folder_for_text</span><span class="p">(</span>
    <span class="n">entry</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;.tsv&quot;</span><span class="p">),</span> <span class="n">line_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_str</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find any particular string entry in the text files of a folder.</span>

<span class="sd">    .. note:: This is a search function like `grep</span>
<span class="sd">              &lt;https://man7.org/linux/man-pages/man1/fgrep.1.html&gt;`_</span>
<span class="sd">              that is formatted nicely for BIDS datasets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    entry : str</span>
<span class="sd">        The string to search for</span>
<span class="sd">    folder : path-like</span>
<span class="sd">        The folder in which to search.</span>
<span class="sd">    extensions : list | tuple | str</span>
<span class="sd">        The extensions to search through. Default is ``json`` and</span>
<span class="sd">        ``tsv`` which are the BIDS sidecar file types.</span>
<span class="sd">    line_numbers : bool</span>
<span class="sd">        Whether to include line numbers.</span>
<span class="sd">    return_str : bool</span>
<span class="sd">        If ``True``, return the fields with &quot;n/a&quot; as a str instead of</span>
<span class="sd">        printing them.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str | None</span>
<span class="sd">        If `return_str` is ``True``, the fields are returned as a</span>
<span class="sd">        string. Else, ``None`` is returned and the fields are printed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_validate_type</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;entry&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{folder}</span><span class="s2"> is not a directory&quot;</span><span class="p">)</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>  <span class="c1"># ensure pathlib.Path</span>

    <span class="n">extensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">extensions</span><span class="p">,)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extensions</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">extensions</span>
    <span class="n">_validate_type</span><span class="p">(</span><span class="n">extensions</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
    <span class="n">_validate_type</span><span class="p">(</span><span class="n">line_numbers</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;line_numbers&quot;</span><span class="p">)</span>
    <span class="n">_validate_type</span><span class="p">(</span><span class="n">return_str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;return_str&quot;</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span> <span class="k">if</span> <span class="n">return_str</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">folder</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">extension</span><span class="p">):</span>
            <span class="n">_print_lines_with_entry</span><span class="p">(</span>
                <span class="n">file</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.tsv&quot;</span><span class="p">,</span> <span class="n">line_numbers</span><span class="p">,</span> <span class="n">outfile</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">outfile</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">_check_max_depth</span><span class="p">(</span><span class="n">max_depth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that max depth is a proper input.&quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;`max_depth` must be a positive integer or None&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_depth</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_depth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="c1"># Use max_depth same as the -L param in the unix `tree` command</span>
    <span class="n">max_depth</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">max_depth</span>


<div class="viewcode-block" id="print_dir_tree"><a class="viewcode-back" href="../../generated/mne_bids.print_dir_tree.html#mne_bids.print_dir_tree">[docs]</a><span class="k">def</span> <span class="nf">print_dir_tree</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_str</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recursively print a directory tree.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : path-like</span>
<span class="sd">        The folder for which to print the directory tree.</span>
<span class="sd">    max_depth : int</span>
<span class="sd">        The maximum depth into which to descend recursively for printing</span>
<span class="sd">        the directory tree.</span>
<span class="sd">    return_str : bool</span>
<span class="sd">        If ``True``, return the directory tree as a str instead of</span>
<span class="sd">        printing it.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str | None</span>
<span class="sd">        If `return_str` is ``True``, the directory tree is returned as a</span>
<span class="sd">        string. Else, ``None`` is returned and the directory tree is printed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="n">_check_fname</span><span class="p">(</span>
        <span class="n">fname</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="n">must_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Folder&quot;</span><span class="p">,</span> <span class="n">need_dir</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">_check_max_depth</span><span class="p">(</span><span class="n">max_depth</span><span class="p">)</span>

    <span class="n">_validate_type</span><span class="p">(</span><span class="n">return_str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;return_str&quot;</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span> <span class="k">if</span> <span class="n">return_str</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># Base length of a tree branch, to normalize each tree&#39;s start to 0</span>
    <span class="n">baselen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Recursively walk through all directories</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Since we&#39;re using `topdown=True`, sorting `dirs` ensures that</span>
        <span class="c1"># `os.walk` will continue walking through directories in alphabetical</span>
        <span class="c1"># order. So although we&#39;re not actually using `dirs` anywhere below,</span>
        <span class="c1"># sorting it here is imperative to ensure the correct (alphabetical)</span>
        <span class="c1"># directory sort order in the output.</span>
        <span class="n">dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># Check how far we have walked</span>
        <span class="n">branchlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span> <span class="o">-</span> <span class="n">baselen</span>

        <span class="c1"># Only print if this is up to the depth we asked</span>
        <span class="k">if</span> <span class="n">branchlen</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">branchlen</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;|</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">branchlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="s2">&quot;---&quot;</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                    <span class="p">),</span>
                    <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Only print files if we are NOT yet up to max_depth or beyond</span>
            <span class="k">if</span> <span class="n">branchlen</span> <span class="o">&lt;</span> <span class="n">max_depth</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">branchlen</span> <span class="o">*</span> <span class="s2">&quot;---&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">outfile</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">outfile</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">_parse_ext</span><span class="p">(</span><span class="n">raw_fname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split a filename into its name and extension.&quot;&quot;&quot;</span>
    <span class="n">raw_fname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">raw_fname</span><span class="p">)</span>
    <span class="n">fname</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">raw_fname</span><span class="p">)</span>
    <span class="c1"># BTi data is the only file format that does not have a file extension</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="s2">&quot;c,rf&quot;</span> <span class="ow">in</span> <span class="n">fname</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;Found no extension for raw file, assuming &quot;BTi&quot; format &#39;</span>
            <span class="s2">&quot;and appending extension .pdf&quot;</span>
        <span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.pdf&quot;</span>
    <span class="c1"># If ending on .gz, check whether it is an .nii.gz file</span>
    <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.gz&quot;</span> <span class="ow">and</span> <span class="n">raw_fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nii.gz&quot;</span><span class="p">):</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.nii.gz&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># cut off the .nii</span>
    <span class="k">return</span> <span class="n">fname</span><span class="p">,</span> <span class="n">ext</span>


<span class="k">def</span> <span class="nf">_infer_datatype_from_path</span><span class="p">(</span><span class="n">fname</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="c1"># get the parent</span>
    <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">datatype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="s2">&quot;ses&quot;</span><span class="p">]]):</span>
            <span class="n">datatype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">fname</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;meg&quot;</span><span class="p">,</span> <span class="s2">&quot;eeg&quot;</span><span class="p">,</span> <span class="s2">&quot;ieeg&quot;</span><span class="p">):</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">datatype</span>


<div class="viewcode-block" id="get_bids_path_from_fname"><a class="viewcode-back" href="../../generated/mne_bids.get_bids_path_from_fname.html#mne_bids.get_bids_path_from_fname">[docs]</a><span class="nd">@verbose</span>
<span class="k">def</span> <span class="nf">get_bids_path_from_fname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a BIDSPath object from a filename.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : path-like</span>
<span class="sd">        The path to parse a `BIDSPath` from.</span>
<span class="sd">    check : bool</span>
<span class="sd">        Whether to check if the generated `BIDSPath` complies with the BIDS</span>
<span class="sd">        specification, i.e., whether all included entities and the suffix are</span>
<span class="sd">        valid.</span>
<span class="sd">    %(verbose)s</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bids_path : BIDSPath</span>
<span class="sd">        The BIDSPath object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">fpath</span><span class="o">.</span><span class="n">name</span>

    <span class="n">entities</span> <span class="o">=</span> <span class="n">get_entities_from_fname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

    <span class="c1"># parse suffix and extension</span>
    <span class="n">last_entity</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">last_entity</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">last_entity</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">suffix</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">_get_bids_suffix_and_ext</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>  <span class="c1"># already starts with a period</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">extension</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>  <span class="c1"># better safe than sorry</span>

    <span class="n">datatype</span> <span class="o">=</span> <span class="n">_infer_datatype_from_path</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

    <span class="c1"># find root and datatype if it exists</span>
    <span class="k">if</span> <span class="n">fpath</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># determine root if it&#39;s there</span>
        <span class="k">if</span> <span class="n">entities</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root_level</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">entities</span><span class="p">[</span><span class="s2">&quot;session&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root_level</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">suffix</span> <span class="o">!=</span> <span class="s2">&quot;scans&quot;</span><span class="p">:</span>
            <span class="n">root_level</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">root_level</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">fpath</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">root_level</span><span class="p">):</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">parent</span>

    <span class="n">bids_path</span> <span class="o">=</span> <span class="n">BIDSPath</span><span class="p">(</span>
        <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
        <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">,</span>
        <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span>
        <span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span>
        <span class="o">**</span><span class="n">entities</span><span class="p">,</span>
        <span class="n">check</span><span class="o">=</span><span class="n">check</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;From </span><span class="si">{</span><span class="n">fpath</span><span class="si">}</span><span class="s2">, formed a BIDSPath: </span><span class="si">{</span><span class="n">bids_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bids_path</span></div>


<div class="viewcode-block" id="get_entities_from_fname"><a class="viewcode-back" href="../../generated/mne_bids.get_entities_from_fname.html#mne_bids.get_entities_from_fname">[docs]</a><span class="nd">@verbose</span>
<span class="k">def</span> <span class="nf">get_entities_from_fname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">on_error</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a dictionary of BIDS entities from a filename.</span>

<span class="sd">    Entities not present in ``fname`` will be assigned the value of ``None``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fname : BIDSPath | path-like</span>
<span class="sd">        The path to parse.</span>
<span class="sd">    on_error : &#39;raise&#39; | &#39;warn&#39; | &#39;ignore&#39;</span>
<span class="sd">        If any unsupported labels in the filename are found and this is set</span>
<span class="sd">        to ``&#39;raise&#39;``, raise a ``RuntimeError``. If ``&#39;warn&#39;``,</span>
<span class="sd">        emit a warning and continue, and if ``&#39;ignore&#39;``,</span>
<span class="sd">        neither raise an exception nor a warning, and</span>
<span class="sd">        return all entities found. For example, currently MNE-BIDS does not</span>
<span class="sd">        support derivatives yet, but the ``desc`` entity label is used to</span>
<span class="sd">        differentiate different derivatives and will work with this function</span>
<span class="sd">        if ``on_error=&#39;ignore&#39;``.</span>
<span class="sd">    %(verbose)s</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    params : dict</span>
<span class="sd">        A dictionary with the keys corresponding to the BIDS entity names, and</span>
<span class="sd">        the values to the entity values encoded in the filename.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; fname = &#39;sub-01_ses-exp_run-02_meg.fif&#39;</span>
<span class="sd">    &gt;&gt;&gt; get_entities_from_fname(fname)</span>
<span class="sd">    {&#39;subject&#39;: &#39;01&#39;, \</span>
<span class="sd">&#39;session&#39;: &#39;exp&#39;, \</span>
<span class="sd">&#39;task&#39;: None, \</span>
<span class="sd">&#39;acquisition&#39;: None, \</span>
<span class="sd">&#39;run&#39;: &#39;02&#39;, \</span>
<span class="sd">&#39;processing&#39;: None, \</span>
<span class="sd">&#39;space&#39;: None, \</span>
<span class="sd">&#39;recording&#39;: None, \</span>
<span class="sd">&#39;split&#39;: None, \</span>
<span class="sd">&#39;description&#39;: None}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">on_error</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Acceptable values for on_error are: warn, raise, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;ignore, but got: </span><span class="si">{</span><span class="n">on_error</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>  <span class="c1"># to accept also BIDSPath or Path instances</span>

    <span class="c1"># filename keywords to the BIDS entity mapping</span>
    <span class="n">entity_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ALLOWED_PATH_ENTITIES_SHORT</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">fname_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ALLOWED_PATH_ENTITIES_SHORT</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">entity_vals</span><span class="p">}</span>
    <span class="n">idx_key</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">param_regex</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">)):</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">on_error</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;warn&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fname_vals</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Unexpected entity &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; found in &#39;</span> <span class="sa">f</span><span class="s1">&#39;filename &quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;warn&quot;</span><span class="p">:</span>
                    <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="n">fname_vals</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">idx_key</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Entities in filename not ordered correctly.&quot;</span>
                    <span class="sa">f</span><span class="s1">&#39; &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot; should have occurred earlier in the &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;filename &quot;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">idx_key</span> <span class="o">=</span> <span class="n">fname_vals</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">key_short_hand</span> <span class="o">=</span> <span class="n">ALLOWED_PATH_ENTITIES_SHORT</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="n">key_short_hand</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">params</span></div>


<span class="k">def</span> <span class="nf">_find_matching_sidecar</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_error</span><span class="o">=</span><span class="s2">&quot;raise&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Try to find a sidecar file with a given suffix for a data file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bids_path : BIDSPath</span>
<span class="sd">        Full name of the data file.</span>
<span class="sd">    suffix : str | None</span>
<span class="sd">        The filename suffix. This is the entity after the last ``_``</span>
<span class="sd">        before the extension. E.g., ``&#39;ieeg&#39;``.</span>
<span class="sd">    extension : str | None</span>
<span class="sd">        The extension of the filename. E.g., ``&#39;.json&#39;``.</span>
<span class="sd">    on_error : &#39;raise&#39; | &#39;warn&#39; | &#39;ignore&#39;</span>
<span class="sd">        If no matching sidecar file was found and this is set to ``&#39;raise&#39;``,</span>
<span class="sd">        raise a ``RuntimeError``. If ``&#39;warn&#39;``, emit a warning, and if</span>
<span class="sd">        ``&#39;ignore&#39;``, neither raise an exception nor a warning, and return</span>
<span class="sd">        ``None`` in both cases.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sidecar_fname : str | None</span>
<span class="sd">        Path to the identified sidecar file, or ``None`` if none could be found</span>
<span class="sd">        and ``on_error`` was set to ``&#39;warn&#39;`` or ``&#39;ignore&#39;``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">on_error</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;warn&quot;</span><span class="p">,</span> <span class="s2">&quot;raise&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Acceptable values for on_error are: warn, raise, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;ignore, but got: </span><span class="si">{</span><span class="n">on_error</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">bids_root</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">root</span>

    <span class="c1"># search suffix is BIDS-suffix and extension</span>
    <span class="n">search_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_suffix</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">suffix</span>
    <span class="k">elif</span> <span class="n">suffix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_suffix</span> <span class="o">=</span> <span class="n">suffix</span>

        <span class="c1"># do not search for suffix if suffix is explicitly passed</span>
        <span class="n">bids_path</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bids_path</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bids_path</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extension</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_suffix</span> <span class="o">=</span> <span class="n">search_suffix</span> <span class="o">+</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">extension</span>
    <span class="k">elif</span> <span class="n">extension</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_suffix</span> <span class="o">=</span> <span class="n">search_suffix</span> <span class="o">+</span> <span class="n">extension</span>

        <span class="c1"># do not search for extension if extension is explicitly passed</span>
        <span class="n">bids_path</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">bids_path</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bids_path</span> <span class="o">=</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># We only use subject and session as identifier, because all other</span>
    <span class="c1"># parameters are potentially not binding for metadata sidecar files</span>
    <span class="n">search_str_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sub-</span><span class="si">{</span><span class="n">bids_path</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_str_filename</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_ses-</span><span class="si">{</span><span class="n">bids_path</span><span class="o">.</span><span class="n">session</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Find all potential sidecar files, doing a recursive glob</span>
    <span class="c1"># from bids_root/sub-*, potentially taking into account the data type</span>
    <span class="n">search_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_root</span><span class="p">)</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;sub-</span><span class="si">{</span><span class="n">bids_path</span><span class="o">.</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="c1"># ** -&gt; don&#39;t forget about potentially present session directories</span>
    <span class="k">if</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">search_dir</span> <span class="o">=</span> <span class="n">search_dir</span> <span class="o">/</span> <span class="s2">&quot;**&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">search_dir</span> <span class="o">=</span> <span class="n">search_dir</span> <span class="o">/</span> <span class="s2">&quot;**&quot;</span> <span class="o">/</span> <span class="n">bids_path</span><span class="o">.</span><span class="n">datatype</span>

    <span class="n">search_str_complete</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">search_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">search_str_filename</span><span class="si">}</span><span class="s2">*</span><span class="si">{</span><span class="n">search_suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">candidate_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">search_str_complete</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">best_candidates</span> <span class="o">=</span> <span class="n">_find_best_candidates</span><span class="p">(</span><span class="n">bids_path</span><span class="o">.</span><span class="n">entities</span><span class="p">,</span> <span class="n">candidate_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Success</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">best_candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># We failed. Construct a helpful error message.</span>
    <span class="c1"># If this was expected, simply return None, otherwise, raise an exception.</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Did not find any </span><span class="si">{</span><span class="n">search_suffix</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;associated with </span><span class="si">{</span><span class="n">bids_path</span><span class="o">.</span><span class="n">basename</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># More than one candidates were tied for best match</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Expected to find a single </span><span class="si">{</span><span class="n">search_suffix</span><span class="si">}</span><span class="s2"> file &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;associated with </span><span class="si">{</span><span class="n">bids_path</span><span class="o">.</span><span class="n">basename</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;but found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">candidate_list</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">candidate_list</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">The search_str was &quot;</span><span class="si">{</span><span class="n">search_str_complete</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="k">if</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">on_error</span> <span class="o">==</span> <span class="s2">&quot;warn&quot;</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_get_bids_suffix_and_ext</span><span class="p">(</span><span class="n">str_suffix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse suffix for valid suffix and ext.&quot;&quot;&quot;</span>
    <span class="c1"># no matter what the suffix is, suffix and extension are last</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">str_suffix</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">str_suffix</span><span class="p">:</span>
        <span class="c1"># handle case of multiple &#39;.&#39; in extension</span>
        <span class="n">split_str</span> <span class="o">=</span> <span class="n">str_suffix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">split_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># prepend period</span>
    <span class="k">return</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">ext</span>


<div class="viewcode-block" id="get_datatypes"><a class="viewcode-back" href="../../generated/mne_bids.get_datatypes.html#mne_bids.get_datatypes">[docs]</a><span class="nd">@verbose</span>
<span class="k">def</span> <span class="nf">get_datatypes</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of data types (&quot;modalities&quot;) present in a BIDS dataset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    root : path-like</span>
<span class="sd">        Path to the root of the BIDS directory.</span>
<span class="sd">    %(verbose)s</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    modalities : list of str</span>
<span class="sd">        List of the data types present in the BIDS dataset pointed to by</span>
<span class="sd">        `root`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Take all possible data types from &quot;entity&quot; table</span>
    <span class="c1"># (Appendix in BIDS spec)</span>
    <span class="c1"># https://bids-specification.readthedocs.io/en/latest/appendices/entity-table.html  # noqa</span>
    <span class="n">datatype_list</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;func&quot;</span><span class="p">,</span> <span class="s2">&quot;dwi&quot;</span><span class="p">,</span> <span class="s2">&quot;fmap&quot;</span><span class="p">,</span> <span class="s2">&quot;beh&quot;</span><span class="p">,</span> <span class="s2">&quot;meg&quot;</span><span class="p">,</span> <span class="s2">&quot;eeg&quot;</span><span class="p">,</span> <span class="s2">&quot;ieeg&quot;</span><span class="p">,</span> <span class="s2">&quot;nirs&quot;</span><span class="p">)</span>
    <span class="n">datatypes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">datatype_list</span> <span class="ow">and</span> <span class="nb">dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">datatypes</span><span class="p">:</span>
                <span class="n">datatypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datatypes</span></div>


<div class="viewcode-block" id="get_entity_vals"><a class="viewcode-back" href="../../generated/mne_bids.get_entity_vals.html#mne_bids.get_entity_vals">[docs]</a><span class="nd">@verbose</span>
<span class="k">def</span> <span class="nf">get_entity_vals</span><span class="p">(</span>
    <span class="n">root</span><span class="p">,</span>
    <span class="n">entity_key</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">ignore_subjects</span><span class="o">=</span><span class="s2">&quot;emptyroom&quot;</span><span class="p">,</span>
    <span class="n">ignore_sessions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_runs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_processings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_spaces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_acquisitions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_splits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_descriptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_modalities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_datatypes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ignore_dirs</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;sourcedata&quot;</span><span class="p">),</span>
    <span class="n">with_key</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of values associated with an `entity_key` in a BIDS dataset.</span>

<span class="sd">    BIDS file names are organized by key-value pairs called &quot;entities&quot; [1]_.</span>
<span class="sd">    With this function, you can get all values for an entity indexed by its</span>
<span class="sd">    key.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    root : path-like</span>
<span class="sd">        Path to the &quot;root&quot; directory from which to start traversing to gather</span>
<span class="sd">        BIDS entities from file- and folder names. This will commonly be the</span>
<span class="sd">        BIDS root, but it may also be a subdirectory inside of a BIDS dataset,</span>
<span class="sd">        e.g., the ``sub-X`` directory of a hypothetical subject ``X``.</span>

<span class="sd">        .. note:: This function searches the names of all files and directories</span>
<span class="sd">                  nested within ``root``. Depending on the size of your</span>
<span class="sd">                  dataset and storage system, searching the entire BIDS dataset</span>
<span class="sd">                  may take a **considerable** amount of time (seconds up to</span>
<span class="sd">                  several minutes). If you find yourself running into such</span>
<span class="sd">                  performance issues, consider limiting the search to only a</span>
<span class="sd">                  subdirectory in the dataset, e.g., to a single subject or</span>
<span class="sd">                  session only.</span>

<span class="sd">    entity_key : str</span>
<span class="sd">        The name of the entity key to search for.</span>
<span class="sd">    ignore_subjects : str | array-like of str | None</span>
<span class="sd">        Subject(s) to ignore. By default, entities from the ``emptyroom``</span>
<span class="sd">        mock-subject are not returned. If ``None``, include all subjects.</span>
<span class="sd">    ignore_sessions : str | array-like of str | None</span>
<span class="sd">        Session(s) to ignore. If ``None``, include all sessions.</span>
<span class="sd">    ignore_tasks : str | array-like of str | None</span>
<span class="sd">        Task(s) to ignore. If ``None``, include all tasks.</span>
<span class="sd">    ignore_runs : str | array-like of str | None</span>
<span class="sd">        Run(s) to ignore. If ``None``, include all runs.</span>
<span class="sd">    ignore_processings : str | array-like of str | None</span>
<span class="sd">        Processing(s) to ignore. If ``None``, include all processings.</span>
<span class="sd">    ignore_spaces : str | array-like of str | None</span>
<span class="sd">        Space(s) to ignore. If ``None``, include all spaces.</span>
<span class="sd">    ignore_acquisitions : str | array-like of str | None</span>
<span class="sd">        Acquisition(s) to ignore. If ``None``, include all acquisitions.</span>
<span class="sd">    ignore_splits : str | array-like of str | None</span>
<span class="sd">        Split(s) to ignore. If ``None``, include all splits.</span>
<span class="sd">    ignore_descriptions : str | array-like of str | None</span>
<span class="sd">        Description(s) to ignore. If ``None``, include all descriptions.</span>

<span class="sd">        .. versionadded:: 0.11</span>
<span class="sd">    ignore_modalities : str | array-like of str | None</span>
<span class="sd">        Modalities(s) to ignore. If ``None``, include all modalities.</span>
<span class="sd">    ignore_datatypes : str | array-like of str | None</span>
<span class="sd">        Datatype(s) to ignore. If ``None``, include all datatypes (i.e.</span>
<span class="sd">        ``anat``, ``ieeg``, ``eeg``, ``meg``, ``func``, etc.)</span>
<span class="sd">    ignore_dirs : str | array-like of str | None</span>
<span class="sd">        Directories nested directly within ``root`` to ignore. If ``None``,</span>
<span class="sd">        include all directories in the search.</span>

<span class="sd">        .. versionadded:: 0.9</span>
<span class="sd">    with_key : bool</span>
<span class="sd">        If ``True``, returns the full entity with the key and the value. This</span>
<span class="sd">        will for example look like ``[&#39;sub-001&#39;, &#39;sub-002&#39;]``.</span>
<span class="sd">        If ``False`` (default), just returns the entity values. This</span>
<span class="sd">        will for example look like ``[&#39;001&#39;, &#39;002&#39;]``.</span>
<span class="sd">    %(verbose)s</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    entity_vals : list of str</span>
<span class="sd">        List of the values associated with an `entity_key` in the BIDS dataset</span>
<span class="sd">        pointed to by `root`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; root = Path(&#39;./mne_bids/tests/data/tiny_bids&#39;).absolute()</span>
<span class="sd">    &gt;&gt;&gt; entity_key = &#39;subject&#39;</span>
<span class="sd">    &gt;&gt;&gt; get_entity_vals(root, entity_key)</span>
<span class="sd">    [&#39;01&#39;]</span>
<span class="sd">    &gt;&gt;&gt; get_entity_vals(root, entity_key, with_key=True)</span>
<span class="sd">    [&#39;sub-01&#39;]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function will scan the entire ``root``, except for a</span>
<span class="sd">    ``derivatives`` subfolder placed directly under ``root``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] https://bids-specification.rtfd.io/en/latest/common-principles.html#entities  # noqa: E501</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">_check_fname</span><span class="p">(</span>
        <span class="n">fname</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="s2">&quot;read&quot;</span><span class="p">,</span>
        <span class="n">must_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">need_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Root directory&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="n">entities</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;subject&quot;</span><span class="p">,</span>
        <span class="s2">&quot;task&quot;</span><span class="p">,</span>
        <span class="s2">&quot;session&quot;</span><span class="p">,</span>
        <span class="s2">&quot;run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;processing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;space&quot;</span><span class="p">,</span>
        <span class="s2">&quot;acquisition&quot;</span><span class="p">,</span>
        <span class="s2">&quot;split&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">,</span>
        <span class="s2">&quot;suffix&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">entities_abbr</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;sub&quot;</span><span class="p">,</span>
        <span class="s2">&quot;task&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ses&quot;</span><span class="p">,</span>
        <span class="s2">&quot;run&quot;</span><span class="p">,</span>
        <span class="s2">&quot;proc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;space&quot;</span><span class="p">,</span>
        <span class="s2">&quot;acq&quot;</span><span class="p">,</span>
        <span class="s2">&quot;split&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;suffix&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">entity_long_abbr_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="n">entities_abbr</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">entity_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;`key` must be one of: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span><span class="si">}</span><span class="s1">. &#39;</span> <span class="sa">f</span><span class="s2">&quot;Got: </span><span class="si">{</span><span class="n">entity_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">ignore_subjects</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_subjects</span><span class="p">)</span>
    <span class="n">ignore_sessions</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_sessions</span><span class="p">)</span>
    <span class="n">ignore_tasks</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_tasks</span><span class="p">)</span>
    <span class="n">ignore_runs</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_runs</span><span class="p">)</span>
    <span class="n">ignore_processings</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_processings</span><span class="p">)</span>
    <span class="n">ignore_spaces</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_spaces</span><span class="p">)</span>
    <span class="n">ignore_acquisitions</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_acquisitions</span><span class="p">)</span>
    <span class="n">ignore_splits</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_splits</span><span class="p">)</span>
    <span class="n">ignore_descriptions</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_descriptions</span><span class="p">)</span>
    <span class="n">ignore_modalities</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_modalities</span><span class="p">)</span>

    <span class="n">ignore_dirs</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">ignore_dirs</span><span class="p">)</span>
    <span class="n">existing_ignore_dirs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">root</span> <span class="o">/</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ignore_dirs</span> <span class="k">if</span> <span class="p">(</span><span class="n">root</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">root</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="n">ignore_dirs</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">existing_ignore_dirs</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-(.*?)_&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_long_abbr_map</span><span class="p">[</span><span class="n">entity_key</span><span class="p">]))</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**/*</span><span class="si">{</span><span class="n">entity_long_abbr_map</span><span class="p">[</span><span class="n">entity_key</span><span class="p">]</span><span class="si">}</span><span class="s2">-*_*&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="c1"># Skip ignored directories</span>
        <span class="c1"># XXX In Python 3.9, we can use Path.is_relative_to() here</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ignore_dir</span><span class="p">))</span> <span class="k">for</span> <span class="n">ignore_dir</span> <span class="ow">in</span> <span class="n">ignore_dirs</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">ignore_datatypes</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">ignore_datatypes</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_subjects</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="n">filename</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sub-</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ignore_subjects</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_sessions</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_ses-</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ignore_sessions</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_tasks</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;_task-</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ignore_tasks</span><span class="p">]):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_runs</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;_run-</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ignore_runs</span><span class="p">]):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_processings</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_proc-</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ignore_processings</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_spaces</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_space-</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ignore_spaces</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_acquisitions</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_acq-</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ignore_acquisitions</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_splits</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_split-</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ignore_splits</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_descriptions</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_desc-</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ignore_descriptions</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">ignore_modalities</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">stem</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ignore_modalities</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">stem</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_key</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">entity_long_abbr_map</span><span class="p">[</span><span class="n">entity_key</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_mkdir_p</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a directory, making parent directories as needed [1].</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] stackoverflow.com/questions/600268/mkdir-p-functionality-in-python</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clearing path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating folder: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_find_best_candidates</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">candidate_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the best candidate, based on the number of param matches.</span>

<span class="sd">    Assign each candidate a score, based on how many entities are shared with</span>
<span class="sd">    the ones supplied in the `params` parameter. The candidate with the highest</span>
<span class="sd">    score wins. Candidates with entities that conflict with the supplied</span>
<span class="sd">    `params` are disqualified.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params : dict</span>
<span class="sd">        The entities that the candidate should match.</span>
<span class="sd">    candidate_list : list of str</span>
<span class="sd">        A list of candidate filenames.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    best_candidates : list of str</span>
<span class="sd">        A list of all the candidate filenames that are tied for first place.</span>
<span class="sd">        Hopefully, the list will have a length of one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="n">best_candidates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_n_matches</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">candidate_list</span><span class="p">:</span>
        <span class="n">n_matches</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">candidate_disqualified</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">candidate_params</span> <span class="o">=</span> <span class="n">get_entities_from_fname</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entity</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">candidate_params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">candidate_params</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">candidate_params</span><span class="p">[</span><span class="n">entity</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">n_matches</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Incompatible entity found, candidate is disqualified</span>
                    <span class="n">candidate_disqualified</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">candidate_disqualified</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_matches</span> <span class="o">&gt;</span> <span class="n">best_n_matches</span><span class="p">:</span>
                <span class="n">best_n_matches</span> <span class="o">=</span> <span class="n">n_matches</span>
                <span class="n">best_candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">candidate</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">n_matches</span> <span class="o">==</span> <span class="n">best_n_matches</span><span class="p">:</span>
                <span class="n">best_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_candidates</span>


<span class="k">def</span> <span class="nf">_get_datatypes_for_sub</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve data modalities for a specific subject and session.&quot;&quot;&quot;</span>
    <span class="n">subject_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sub-</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">subject_dir</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subject_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ses-</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># TODO We do this to ensure we don&#39;t accidentally pick up any &quot;spurious&quot;</span>
    <span class="c1"># TODO sub-directories. But is that really necessary with valid BIDS data?</span>
    <span class="n">modalities_in_dataset</span> <span class="o">=</span> <span class="n">get_datatypes</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="n">subdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">subject_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
    <span class="n">available_modalities</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subdirs</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">modalities_in_dataset</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">available_modalities</span>


<span class="k">def</span> <span class="nf">_infer_datatype</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">):</span>
    <span class="c1"># Check which suffix is available for this particular</span>
    <span class="c1"># subject &amp; session. If we get no or multiple hits, throw an error.</span>

    <span class="n">modalities</span> <span class="o">=</span> <span class="n">_get_datatypes_for_sub</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="o">=</span><span class="n">ses</span><span class="p">)</span>

    <span class="c1"># We only want to handle electrophysiological data here.</span>
    <span class="n">allowed_recording_modalities</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;meg&quot;</span><span class="p">,</span> <span class="s2">&quot;eeg&quot;</span><span class="p">,</span> <span class="s2">&quot;ieeg&quot;</span><span class="p">]</span>
    <span class="n">modalities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">modalities</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">allowed_recording_modalities</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">modalities</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No electrophysiological data found.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">modalities</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Found data of more than one recording datatype. Please &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;pass the `suffix` parameter to specify which data to load. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Found the following modalitiess: </span><span class="si">{</span><span class="n">modalities</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">modalities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">modalities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_path_to_str</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make sure var is a string or Path, return string representation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;All path parameters must be either strings or &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;pathlib.Path objects. Found type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_filter_fnames</span><span class="p">(</span>
    <span class="n">fnames</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">subject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">task</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">acquisition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">processing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">recording</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">space</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">split</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter a list of BIDS filenames / paths based on BIDS entity values.</span>

<span class="sd">    Input can be str or list of str.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fnames : iterable of pathlib.Path | iterable of str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list of pathlib.Path</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="n">acquisition</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">acquisition</span><span class="p">)</span>
    <span class="n">run</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
    <span class="n">processing</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">processing</span><span class="p">)</span>
    <span class="n">space</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
    <span class="n">recording</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">recording</span><span class="p">)</span>
    <span class="n">split</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>

    <span class="n">leading_path_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.*\/?&quot;</span>  <span class="c1"># nothing or something ending with a `/`</span>
    <span class="n">sub_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;sub-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">subject</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;sub-([^_]+)&quot;</span>
    <span class="n">ses_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_ses-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">session</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_ses-([^_]+))&quot;</span>
    <span class="n">task_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_task-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">task</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_task-([^_]+))&quot;</span>
    <span class="n">acq_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;_acq-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acquisition</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">acquisition</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_acq-([^_]+))&quot;</span>
    <span class="p">)</span>
    <span class="n">run_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_run-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">run</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_run-([^_]+))&quot;</span>
    <span class="n">proc_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;_proc-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">processing</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">processing</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_proc-([^_]+))&quot;</span>
    <span class="p">)</span>
    <span class="n">space_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_space-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">space</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_space-([^_]+))&quot;</span>
    <span class="n">rec_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_rec-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">recording</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">recording</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_rec-([^_]+))&quot;</span>
    <span class="n">split_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_split-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">split</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_split-([^_]+))&quot;</span>
    <span class="n">desc_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;_desc-(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">description</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">description</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;(|_desc-([^_]+))&quot;</span>
    <span class="p">)</span>
    <span class="n">suffix_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;_(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">suffix</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;_([^_]+)&quot;</span>
    <span class="n">ext_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="k">if</span> <span class="n">extension</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;.([^_]+)&quot;</span>

    <span class="n">regexp</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">leading_path_str</span>
        <span class="o">+</span> <span class="n">sub_str</span>
        <span class="o">+</span> <span class="n">ses_str</span>
        <span class="o">+</span> <span class="n">task_str</span>
        <span class="o">+</span> <span class="n">acq_str</span>
        <span class="o">+</span> <span class="n">run_str</span>
        <span class="o">+</span> <span class="n">proc_str</span>
        <span class="o">+</span> <span class="n">space_str</span>
        <span class="o">+</span> <span class="n">rec_str</span>
        <span class="o">+</span> <span class="n">split_str</span>
        <span class="o">+</span> <span class="n">desc_str</span>
        <span class="o">+</span> <span class="n">suffix_str</span>
        <span class="o">+</span> <span class="n">ext_str</span>
    <span class="p">)</span>

    <span class="c1"># Convert to str so we can apply the regexp ...</span>
    <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">]</span>

    <span class="c1"># https://stackoverflow.com/a/51246151/1944216</span>
    <span class="n">fnames_filtered</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">,</span> <span class="n">fnames</span><span class="p">))</span>

    <span class="c1"># ... and return Paths.</span>
    <span class="n">fnames_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fnames_filtered</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fnames_filtered</span>


<div class="viewcode-block" id="find_matching_paths"><a class="viewcode-back" href="../../generated/mne_bids.find_matching_paths.html#mne_bids.find_matching_paths">[docs]</a><span class="k">def</span> <span class="nf">find_matching_paths</span><span class="p">(</span>
    <span class="n">root</span><span class="p">,</span>
    <span class="n">subjects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sessions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">acquisitions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">runs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">processings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">recordings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">spaces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">splits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">descriptions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">suffixes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">extensions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">datatypes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of all matching paths for all matching entity values.</span>

<span class="sd">    Input can be str or list of str. None matches all found values.</span>

<span class="sd">    Performs a recursive search, starting in ``.root`` (if set), based on</span>
<span class="sd">    `BIDSPath.entities` object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    root : pathlib.Path | str</span>
<span class="sd">        The root of the BIDS path.</span>
<span class="sd">    subjects : str | array-like of str | None</span>
<span class="sd">        The subject ID. Corresponds to &quot;sub&quot;.</span>
<span class="sd">    sessions : str | array-like of str | None</span>
<span class="sd">        The acquisition session. Corresponds to &quot;ses&quot;.</span>
<span class="sd">    tasks : str | array-like of str | None</span>
<span class="sd">        The experimental task. Corresponds to &quot;task&quot;.</span>
<span class="sd">    acquisitions: str | array-like of str | None</span>
<span class="sd">        The acquisition parameters. Corresponds to &quot;acq&quot;.</span>
<span class="sd">    runs : str | array-like of str | None</span>
<span class="sd">        The run number. Corresponds to &quot;run&quot;.</span>
<span class="sd">    processings : str | array-like of str | None</span>
<span class="sd">        The processing label. Corresponds to &quot;proc&quot;.</span>
<span class="sd">    recordings : str | array-like of str | None</span>
<span class="sd">        The recording name. Corresponds to &quot;rec&quot;.</span>
<span class="sd">    spaces : str | array-like of str | None</span>
<span class="sd">        The coordinate space for anatomical and sensor location</span>
<span class="sd">        files (e.g., ``*_electrodes.tsv``, ``*_markers.mrk``).</span>
<span class="sd">        Corresponds to &quot;space&quot;.</span>
<span class="sd">        Note that valid values for ``space`` must come from a list</span>
<span class="sd">        of BIDS keywords as described in the BIDS specification.</span>
<span class="sd">    splits : str | array-like of str | None</span>
<span class="sd">        The split of the continuous recording file for ``.fif`` data.</span>
<span class="sd">        Corresponds to &quot;split&quot;.</span>
<span class="sd">    descriptions : str | array-like of str | None</span>
<span class="sd">        This corresponds to the BIDS entity ``desc``. It is used to provide</span>
<span class="sd">        additional information for derivative data, e.g., preprocessed data</span>
<span class="sd">        may be assigned ``description=&#39;cleaned&#39;``.</span>

<span class="sd">        .. versionadded:: 0.11</span>
<span class="sd">    suffixes : str | array-like of str | None</span>
<span class="sd">        The filename suffix. This is the entity after the</span>
<span class="sd">        last ``_`` before the extension. E.g., ``&#39;channels&#39;``.</span>
<span class="sd">        The following filename suffix&#39;s are accepted:</span>
<span class="sd">        &#39;meg&#39;, &#39;markers&#39;, &#39;eeg&#39;, &#39;ieeg&#39;, &#39;T1w&#39;,</span>
<span class="sd">        &#39;participants&#39;, &#39;scans&#39;, &#39;electrodes&#39;, &#39;coordsystem&#39;,</span>
<span class="sd">        &#39;channels&#39;, &#39;events&#39;, &#39;headshape&#39;, &#39;digitizer&#39;,</span>
<span class="sd">        &#39;beh&#39;, &#39;physio&#39;, &#39;stim&#39;</span>
<span class="sd">    extensions : str | array-like of str | None</span>
<span class="sd">        The extension of the filename. E.g., ``&#39;.json&#39;``.</span>
<span class="sd">    datatypes : str | array-like of str | None</span>
<span class="sd">        The BIDS data type, e.g., ``&#39;anat&#39;``, ``&#39;func&#39;``, ``&#39;eeg&#39;``, ``&#39;meg&#39;``,</span>
<span class="sd">        ``&#39;ieeg&#39;``.</span>
<span class="sd">    check : bool</span>
<span class="sd">        If ``True``, only returns paths that conform to BIDS. If ``False``</span>
<span class="sd">        (default), the ``.check`` attribute of the returned</span>
<span class="sd">        `mne_bids.BIDSPath` object will be set to ``True`` for paths that</span>
<span class="sd">        do conform to BIDS, and to ``False`` for those that don&#39;t.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bids_paths : list of mne_bids.BIDSPath</span>
<span class="sd">        The matching paths.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fpaths</span> <span class="o">=</span> <span class="n">_return_root_paths</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatypes</span><span class="p">,</span> <span class="n">ignore_json</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">fpaths_filtered</span> <span class="o">=</span> <span class="n">_filter_fnames</span><span class="p">(</span>
        <span class="n">fpaths</span><span class="p">,</span>
        <span class="n">subject</span><span class="o">=</span><span class="n">subjects</span><span class="p">,</span>
        <span class="n">session</span><span class="o">=</span><span class="n">sessions</span><span class="p">,</span>
        <span class="n">task</span><span class="o">=</span><span class="n">tasks</span><span class="p">,</span>
        <span class="n">acquisition</span><span class="o">=</span><span class="n">acquisitions</span><span class="p">,</span>
        <span class="n">run</span><span class="o">=</span><span class="n">runs</span><span class="p">,</span>
        <span class="n">processing</span><span class="o">=</span><span class="n">processings</span><span class="p">,</span>
        <span class="n">recording</span><span class="o">=</span><span class="n">recordings</span><span class="p">,</span>
        <span class="n">space</span><span class="o">=</span><span class="n">spaces</span><span class="p">,</span>
        <span class="n">split</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">descriptions</span><span class="p">,</span>
        <span class="n">suffix</span><span class="o">=</span><span class="n">suffixes</span><span class="p">,</span>
        <span class="n">extension</span><span class="o">=</span><span class="n">extensions</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">bids_paths</span> <span class="o">=</span> <span class="n">_fnames_to_bidspaths</span><span class="p">(</span><span class="n">fpaths_filtered</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="n">check</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bids_paths</span></div>


<span class="k">def</span> <span class="nf">_return_root_paths</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_json</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all paths in root.</span>

<span class="sd">    Can be filtered by datatype (which is present in the path but not in</span>
<span class="sd">    the BIDSPath basename). Can also be list of datatypes.</span>
<span class="sd">    root : pathlib.Path | str</span>
<span class="sd">        The root of the BIDS path.</span>
<span class="sd">    datatype : str | array-like of str | None</span>
<span class="sd">        The BIDS data type, e.g., ``&#39;anat&#39;``, ``&#39;func&#39;``, ``&#39;eeg&#39;``, ``&#39;meg&#39;``,</span>
<span class="sd">        ``&#39;ieeg&#39;``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>  <span class="c1"># if root is str</span>

    <span class="k">if</span> <span class="n">datatype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">_ensure_tuple</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span>
        <span class="n">search_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;*/</span><span class="si">{</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span><span class="si">}</span><span class="s1">/*&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">search_str</span> <span class="o">=</span> <span class="s2">&quot;*.*&quot;</span>

    <span class="n">paths</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="n">search_str</span><span class="p">)</span>
    <span class="c1"># Only keep files (not directories), and omit the JSON sidecars</span>
    <span class="c1"># if ignore_json is True.</span>
    <span class="k">if</span> <span class="n">ignore_json</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">suffix</span> <span class="o">!=</span> <span class="s2">&quot;.json&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">paths</span>


<span class="k">def</span> <span class="nf">_fnames_to_bidspaths</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make BIDSPaths from file names.</span>

<span class="sd">    To check whether the BIDSPath is conforming to BIDS if check=True, we</span>
<span class="sd">    first instantiate without checking and then run the check manually,</span>
<span class="sd">    allowing us to be more specific about the exception to catch.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fnames : list of str</span>
<span class="sd">        Filenames as list of strings.</span>
<span class="sd">    root : path-like | None</span>
<span class="sd">        The root directory of the BIDS dataset.</span>
<span class="sd">    check : bool</span>
<span class="sd">        If ``True``, only returns paths that conform to BIDS. If ``False``</span>
<span class="sd">        (default), the ``.check`` attribute of the returned</span>
<span class="sd">        `mne_bids.BIDSPath` object will be set to ``True`` for paths that</span>
<span class="sd">        do conform to BIDS, and to ``False`` for those that don&#39;t.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bids_paths : list of mne_bids.BIDSPath</span>
<span class="sd">        Bids paths.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bids_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">_infer_datatype_from_path</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">bids_path</span> <span class="o">=</span> <span class="n">get_bids_path_from_fname</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">bids_path</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="n">bids_path</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="n">datatype</span>
        <span class="n">bids_path</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">bids_path</span><span class="o">.</span><span class="n">_check</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># path is not BIDS-compatible</span>
            <span class="k">if</span> <span class="n">check</span><span class="p">:</span>  <span class="c1"># skip!</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bids_path</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">bids_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bids_paths</span>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2017-2023, MNE Developers. Last updated on 2023-08-02.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>